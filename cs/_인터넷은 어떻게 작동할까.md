인터넷은 어떻게 동작할까?
======

※ http://www.theshulers.com/whitepapers/internet_whitepaper/index.html 를 보고 정리한 글입니다. 잘못된 내용에 대한 지적 언제나 환영합니다😂

-----

### 인터넷 주소 (Internet Addresses)

인터넷은 많은 컴퓨터들이 연결된 아주 큰 네트워크입니다. 따라서 컴퓨터의 위치를 식별하고 알아내기 위해서 인터넷에 연결된 컴퓨터들은 __반드시__ 고유한 주소를 가져야 합니다. 인터넷 주소 형태인 __nnn.nnn.nnn.nnn__ 에서 n에는 0 - 255 숫자가 들어가야합니다. 이 주소가 바로 IP 주소입니다.


<br>
<img src="http://www.theshulers.com/whitepapers/internet_whitepaper/images/ruswp_diag1.gif"  alt="컴퓨터1<->인터넷<->컴퓨터2"><img/><br/>

만약 당신이 ISP 서비스(Internet Service Provider)를 통해 인터넷에 연결되어 있다면 일반적으로 접속하는 동안 임시 IP 주소를 할당받게됩니다. 만약 당신이 LAN(local area network)를 통해 인터넷에 연결되어 있다면 당신의 컴퓨터는 영구적인 IP 주소를 가지고 있을겁니다. 혹은 DHCP 서버에서 나온 주소를 포함하고 있을겁니다. 어떤 경우라도 당신의 컴퓨터가 인터넷에 연결되어있다면 그 컴퓨터는 유니크한 IP 주소를 가지고 있습니다.


----

### 프로토콜 스택과 패킷(Protocol Stacks and Packets)

인터넷에 연결되있는 컴퓨터가 유니크한 IP 주소를 가지고 있다는 것은 알았습니다!! 그렇다면 이녀석들은 어떻게 인터넷을 통해서 '대화'를 할 수 있을까요? 예시를 들어봅시다!! 당신의 컴퓨터 IP 주소는 1.2.3.4 이고 당신은 IP 주소가 5.6.7.8인 컴퓨터에게 __안녕!__ 이라는 메세지를 보내길 원하고 있습니다. 어떻게 보내야할까.. 흠~ 분명한건 이메세지는 인터넷을 통해서 전달되어야 할것으로 보이내요. 당신이 ISP 서비스를 통해 통신을 하고 있고, 메세지가 전화선(phone line)을 통해 전달되어야 한다고 해볼게요. 메세지는 알파벳에서 전기신호로 변환될거고, 인터넷을 통해 전달되고, 다시 전기신호에서 알파벳으로 전환될 거에요. 이것들이 어떻게 이루어 질 수 있을까요? 바로 __프로토콜 스택(protocol stack)__ 통해서 에요!! 모든 컴퓨터는 인터넷을 통해 대화하기위해 프로토콜 스택이 필요합니다. 이것은 보통 컴퓨터의 OS(window, unix... 등등)에 들어있어요.
<br/>
인터넷에서 사용되는 프로토콜 스택은 TCP/IP 프로토콜로 불리웁니다. 왜냐하면 두 프로토콜이 사용 되거든요. TCP/IP 프로토콜은 아래처럼 생겼어요:


|프로토콜 계층(Protocol Layer)|설명|
|---|---|
|어플리케이션 계층(Application Protocols Layer)|WWW, 이메일, FTP 등과 같은 애플리케이션에 특정한 프로토콜|
|TCP(Transmission Control Protocol Layer)|포트넘버를 참조하여 패킷을 특정 어플리케이션에 전달합니다|
|IP(Internet Protocol Layer)|IP 주소를 참조하여 패킷을 특정 컴퓨터에 전달합니다|
|하드웨어 계층(Hardware Layer)|2진 패킷 내용을 네트워크 신호로 변환합니다.(혹은 그반대로 변환합니다)|
<br/>

위 표를 따라 __안녕!__ 메세지를 보낸다면 아래 그림처럼 메세지가 흘러가게 됩니다:<br/>
<img src="http://www.theshulers.com/whitepapers/internet_whitepaper/images/ruswp_diag2.gif" alt="이미지" />

1. 당신의 컴퓨터의 프로토콜 맨 꼭대기에서 메세지가 출발합니다.
2. 메세지가 많이 길다면, 각각의 스택 계층은 데이터를 조각으로 자르게 됩니다. 인터넷에서 이조각들은 __패킷(packets)__ 이라고 불립니다.
3. 패킷은 Application 계층을 통과하여 TCP 레이어로 진입하게됩니다. 각각의 패킷들에 __포트넘버__ 가 할당됩니다. 포트넘버는 패킷이 목적지 컴퓨터에 도달하여 목적 Application을 찾는데 사용 됩니다.
4. 패킷들은 TCP 계층을 지나 IP 레이어에 도달합니다. 여기서 패킷들에게 목적 컴퓨터의 IP 주소 5.6.7.8을 받게됩니다.
5. 이제 우리 패킷들은 목적지 IP 주소와 포트번호를 가지고있씁니다!! 마침내 인터넷을 항해할 준비가 끝났습니다. 하드웨어 계층은 패킷들을 전화선(phone line)으로 보낼 수 있도록 알파벳 텍스트를 전기 신호로 변환합니다.
6. 당신의 ISP의 반대쪽 끝은 인터넷에 직접 연결되어 있습니다. ISP의 __라우터(router)__ 는 패킷에 적혀있는 목적지를 확인한 뒤 어디로 보낼지 결정합니다. 종종 패킷의 다음 목적지는 또다른 라우터 일 때도 있습니다.
7. 드디어!! 패킷들이 5.6.7.8 컴퓨터에 도착했습니다. 도착한 패킷들은 다시 TCP/IP 프로토콜 스택을 아래에서 위로 통과합니다.
8. 패킷들이 스택을 통과함에 따라, 패킷을 보낸 컴퓨터 스택을 통과하면서 추가되었던 정보들 (IP 주소, 포트번호..) 들이 해당 스택 계층에서 제거됩니다.
9. 마침내 패킷들이 스택의 꼭대기에 다다르면 패킷들은 원래 형태로 합쳐집니다. __안녕!__
---

### 네트워크 구조 (Networking Infrastructure)

우리는 패킷들이 컴퓨터에서 다른 컴퓨터로 여행할때 인터넷을 통한다는 것을 알았습니다. 그렇다면 인터넷에서는 실제로 어떤일이 일어날까요? 아래 다이어그램을 보시죠~
<br/>
<img src="http://www.theshulers.com/whitepapers/internet_whitepaper/images/ruswp_diag3.gif" />
<br/>
ISP는 전화 접속 고객을 위해 모뎀 풀을 관리합니다. 이 모뎀 풀은 모뎀 풀에서 백본(backbone) 또는 라인 라우터로의 데이터 흐름을 통제하는 컴퓨터에 의해 관리됩니다. 이런 설정들은 네트워크에 대한 접근을 제공하기 때문에 포트서버로 여겨지기도 합니다. 대게 사용 정보및 비용청구에 대한 정보가 이곳에서 수집됩니다.

패킷이 당신의 ISP 지역 장비를 통과한후에 ISP의 백본으로 진입합니다. 패킷은 이곳에서부터 여러 라우터 혹은 백본을 통과하여 목적 컴퓨터까지의 여정을 하게 됩니다. 어떤 라우터를 거치게 되는지 확인이 가능한데, traceroute 기능을 사용하면 패킷이 거쳐가는 라우터를 볼 수 있습니다.

> __traceroute__ : 패킷이 목적지로 이동하면서 어떤 라우터를 거치는지 추적하여 보여주는 기능. ex) 윈도우에서 tracert www.yahoo.com. 를 터미널에 입력하면 패킷이 어떤 라우터를 거쳐 yahoo에 도달하는지 알 수 있습니다.

---


### 인터넷 구조 (Internet Infrastructure)

인터넷 백본은 서로 상호작용하는 여러개의 거대한 네트워크로 이루어져 있습니다. 이런 거대 네트워크들을은 __NSP(Network Service Providers)__ 로 불립니다. NSP들은 서로를 __피어링__ 합니다. (피어링: 네트워크를 연결하고 트래픽을 교환하는일). 각각 의 NSP는 3개의 __NAP(Network Access Point)__ 에 연결되도록 요구됩니다. NAP에서 패킷은 NSP의 백본에서 다른 NSP의 백본으로 이동합니다. NSP는 또한 __MAE(Metropolitan Area Exchanges)__ 와도 통신합니다. MAE는 NAP와 동일한 목적으로 기능을 제공하지만 사적으로 소유되어있다는 차이점이 있습니다. NAP가 원래의 인터넷 통신 지점이였습니다. NAP와 MAE 모두 인터넷 통신 지점 __(IX)__ 으로 여겨집니다. 아래 이미지에서 NSP와 ISP가 어떻게연결되는지를 보여줍니다:
<br/>
<img src="http://web.stanford.edu/class/msande91si/www-spr04/readings/week1/InternetWhitepaper_files/ruswp_diag4.gif" />
<br/>
위 이미지는 실제 인터넷의 일부를 표현한 모습이 아닙니다. 오직 NSP가 ISP와 어떻게 상호작용하는지 표현한 그림입니다.

----

### 인터넷 라우팅 계층구조 (The Internet Routing Hierarchy)

그렇다면 패킷들은 인터넷을 통과하면서 어떻게 그들이 가야 할 길을 찾을수 있을까요? 인터넷에 연결되어 있는 모든 컴퓨터들이 다른 컴퓨터가 어디있는지 알고 있는 것일까요? 그저 단순히 패킷은 인터넷에 '방송'(to 모든컴퓨터에게) 되는 것일까요? 앞에서 나온 두 질문의 답은 no 입니다. 다른컴퓨터가 어느곳에 있는지 알고있는 컴퓨터는 없습니다. 또한 컴퓨터는 모든 다른 컴퓨터에게 보내지지도 않습니다. 패킷의 목적지를 찾는데 사용되는 정보는 인터넷에 연결되어 있는 라우터들이 유지하는 정보안에 포함되어 있습니다.

__라우터는 패킷 스위치 입니다.__ 라우터는 패킷을 안내하기 위해 보통 네트워크 사이에서 연결되어 있습니다. 각각의 라우터는 그들의 서부 네트워크와 그 안에서 어떤 IP 주소가 사용 되는지 알고 있습니다. 보통 라우터는 어떤 IP 주소가 '위에' 있는지 알지 못합니다. 아래 그림을 보시져. 각 백본에 연결된 검은색 막대기가 라우터 입니다.

<br />
<img src="http://web.stanford.edu/class/msande91si/www-spr04/readings/week1/InternetWhitepaper_files/ruswp_diag5.gif" />
<br />

패킷이 라우터에 도착하면, 라우터는 해당 패킷에 IP protocol이 담아놓은 IP 주소를 보고, 라우터에서 관리하는 라우팅 테이블을 확인합니다. 만약 테이블안에 해당 IP 주소가 있다면 그 네트워크로 패킷을 보냅니다. 만약 테이블안에 해당 IP 주소가 없다면, 상위 계층의 라우터로 패킷을 보냅니다. 마침내 해당 주소를 가지고 있는 라우터를 만난다면, 그 패킷은 다시 더작은 네트워크를 향해 보내지고 목적지에 도착하게 됩니다.

---

### 도메인과 주소확인 (Domain Names and Address Resolution)

만약에 연결하고 싶은 컴퓨터의 IP 주소를 모른다면 어떨까요? 당신이 접속하려고 하는 서버가 _"www.anothercomputer.com"_ 형태라면? 당신의 브라우저는 어떻게 인터넷에서 상대 컴퓨터가 살고있는 곳을 찾아내는 걸까요? 이 모든 질문의 답은 __DNS(Domain Name Service)__ 에 있습니다. DNS는 컴퓨터의 이름과 그에 대응하는 IP 주소를 추적 및 관리하는 분산된 데이터베이스 입니다.

많은 컴퓨터들이 DNS의 일부인 인터넷 호스트와 다른 컴퓨터가 이것에 접속하도록 허용해주는 소프트웨어에 연결되어 있습니다. 이컴퓨터들이 DNS 서버로 알려져있습니다. 전체 DNS 데이터베이스를 가지고 있는 DNS 서버는 없습니다; 그들은 일부만 가지고 있습니다. 만약 DNS 서버가 어떤 도메인 이름을 가지고 있지 않다면 다른 DNS서버로 해당 도메인 이름을 요청한 컴퓨터를 리다이렉트 합니다.

<br />
<img src="http://web.stanford.edu/class/msande91si/www-spr04/readings/week1/InternetWhitepaper_files/ruswp_diag6.gif" />
<br />

DNS 시스템은 IP 라우트 계층구조와 비슷한 구조를 가집니다. 컴퓨터의 이름 해석 요청은 해석이 가능할 때까지 계층구조의 위쪽으로 리다이렉트 됩니다. 조금 더 오래되고, 좀 더 친숙한 도메인이 더 위쪽에 있습니다.

인터넷 연결이 설정되면 하나의 메인 DNS 서버와 하나 또는 그 이상의 보조 DNS 서버가 설치에 포함되어있습니다. 이 방법대로면 도매인 이름 해석이 필요한 어떤 인터넷 어플리케이션도 제대로 동작합니다. 예를들어서 당신이 웹브라우저에 어떤 주소를 입력하고 엔터를 눌렀을때 브라우저는 우선 당신의 DNS 서버에 연결합니다. 입력한 도메인 이름의 IP 주소를 얻은 후 브라우저는 목표 컴퓨터에 연결하고 당신이 원하는 페이지를 요청합니다.

----

### 어플리케이션 프로토콜: HTTP와 Wolrd Wide Web

인터넷에서 가장 많이 쓰이는 서비스 중하나가 바로 WWW 입니다. web 이 알하도록 하는 프로콜이 HTTP 입니다. HTTP는 웹 브라우저와 웹서버가 인터넷을 통해 소통 할때 사용되는 프로토콜 입니다. HTTP는 어플리케이션 레벨 프로토콜인데 왜냐하면 TCP 레이어 위에 있으면서 특정 어플리케이션이 다른 어플리케이션에게 말할때 사용되기 때문입니다. 이 경우에 어플리케이션은 웹 브라우저와 웹 서버 입니다.

HTTP는 텍스트 기반의 비연결 프로토콜 입니다. 클라이언트는 웹서버에게 특정 요청을 보냅니다. 해당 요청이 서버에 의해서 서비스가 되면 클라이언트와 서버간의 연결이 종료됩니다. 각각의 요청마다 새로운 연결이 만들어집니다. 반면 대부분의 프로토콜은 연결 기반 입니다. 이 말은 두 컴퓨터가 서로와 소통 할 때 인터냇을 통해 연결을 유지하는 것을 의미합니다. 하지만 HTTP는 그렇지 않습니다. 클라이언트가 서버에게 HTTP 요청을 하기전에 새로운 연결을 만들어야 합니다.

당신이 URL을 웹브라우저에 입력했을때, 아레의 일들이 일어납니다:
1. URL이 도메인을 포함하고 있다면, 우선 도메인 서버에 연결하여 대응하는 IP 주소를 얻어옵니다.
2. 해당 웹서버에 연결하여 HTTP 요청을 보냅니다.
3. 웹 서버는 요청을 받아 요청을 확인합니다. 요청받은 페이지가 존재할 경우 웹서버는 그 페이지를 보내줍니다. 만약 없을 경우 404 에러를 보내줍니다.
4. 웹 브라우저는 요청한 페이지를 받고 연결은 종료됩니다.
5. 웹 브라우저는 받은 페이지를 파싱합니다.
6. 각각의 요소에 따라 추가로 필요한 것이 있다면 추가 연결을 만들고 HTTP 요청을 보냅니다.
