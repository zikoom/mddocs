인터넷은 어떻게 동작할까?
======

※ http://www.theshulers.com/whitepapers/internet_whitepaper/index.html 를 보고 정리한 글입니다. 잘못된 내용에 대한 지적 언제나 환영합니다😂

-----

### 인터넷 주소 (Internet Addresses)

인터넷은 많은 컴퓨터들이 연결된 아주 큰 네트워크입니다. 따라서 컴퓨터의 위치를 식별하고 알아내기 위해서 인터넷에 연결된 컴퓨터들은 __반드시__ 고유한 주소를 가져야 합니다. 인터넷 주소 형태인 __nnn.nnn.nnn.nnn__ 에서 n에는 0 - 255 숫자가 들어가야합니다. 이 주소가 바로 IP 주소입니다.


<br>
<img src="http://www.theshulers.com/whitepapers/internet_whitepaper/images/ruswp_diag1.gif"  alt="컴퓨터1<->인터넷<->컴퓨터2"><img/><br/>

만약 당신이 ISP 서비스(Internet Service Provider)를 통해 인터넷에 연결되어 있다면 일반적으로 접속하는 동안 임시 IP 주소를 할당받게됩니다. 만약 당신이 LAN(local area network)를 통해 인터넷에 연결되어 있다면 당신의 컴퓨터는 영구적인 IP 주소를 가지고 있을겁니다. 혹은 DHCP 서버에서 나온 주소를 포함하고 있을겁니다. 어떤 경우라도 당신의 컴퓨터가 인터넷에 연결되어있다면 그 컴퓨터는 유니크한 IP 주소를 가지고 있습니다.


----

### 프로토콜 스택과 패킷(Protocol Stacks and Packets)

인터넷에 연결되있는 컴퓨터가 유니크한 IP 주소를 가지고 있다는 것은 알았습니다!! 그렇다면 이녀석들은 어떻게 인터넷을 통해서 '대화'를 할 수 있을까요? 예시를 들어봅시다!! 당신의 컴퓨터 IP 주소는 1.2.3.4 이고 당신은 IP 주소가 5.6.7.8인 컴퓨터에게 __안녕!__ 이라는 메세지를 보내길 원하고 있습니다. 어떻게 보내야할까.. 흠~ 분명한건 이메세지는 인터넷을 통해서 전달되어야 할것으로 보이내요. 당신이 ISP 서비스를 통해 통신을 하고 있고, 메세지가 전화선(phone line)을 통해 전달되어야 한다고 해볼게요. 메세지는 알파벳에서 전기신호로 변환될거고, 인터넷을 통해 전달되고, 다시 전기신호에서 알파벳으로 전환될 거에요. 이것들이 어떻게 이루어 질 수 있을까요? 바로 __프로토콜 스택(protocol stack)__ 통해서 에요!! 모든 컴퓨터는 인터넷을 통해 대화하기위해 프로토콜 스택이 필요합니다. 이것은 보통 컴퓨터의 OS(window, unix... 등등)에 들어있어요.
<br/>
인터넷에서 사용되는 프로토콜 스택은 TCP/IP 프로토콜로 불리웁니다. 왜냐하면 두 프로토콜이 사용 되거든요. TCP/IP 프로토콜은 아래처럼 생겼어요:


|프로토콜 계층(Protocol Layer)|설명|
|---|---|
|어플리케이션 계층(Application Protocols Layer)|WWW, 이메일, FTP 등과 같은 애플리케이션에 특정한 프로토콜|
|TCP(Transmission Control Protocol Layer)|포트넘버를 참조하여 패킷을 특정 어플리케이션에 전달합니다|
|IP(Internet Protocol Layer)|IP 주소를 참조하여 패킷을 특정 컴퓨터에 전달합니다|
|하드웨어 계층(Hardware Layer)|2진 패킷 내용을 네트워크 신호로 변환합니다.(혹은 그반대로 변환합니다)|
<br/>

위 표를 따라 __안녕!__ 메세지를 보낸다면 아래 그림처럼 메세지가 흘러가게 됩니다:<br/>
<img src="http://www.theshulers.com/whitepapers/internet_whitepaper/images/ruswp_diag2.gif" alt="이미지" />

1. 당신의 컴퓨터의 프로토콜 맨 꼭대기에서 메세지가 출발합니다.
2. 메세지가 많이 길다면, 각각의 스택 계층은 데이터를 조각으로 자르게 됩니다. 인터넷에서 이조각들은 __패킷(packets)__ 이라고 불립니다.
3. 패킷은 Application 계층을 통과하여 TCP 레이어로 진입하게됩니다. 각각의 패킷들에 __포트넘버__ 가 할당됩니다. 포트넘버는 패킷이 목적지 컴퓨터에 도달하여 목적 Application을 찾는데 사용 됩니다.
4. 패킷들은 TCP 계층을 지나 IP 레이어에 도달합니다. 여기서 패킷들에게 목적 컴퓨터의 IP 주소 5.6.7.8을 받게됩니다.
5. 이제 우리 패킷들은 목적지 IP 주소와 포트번호를 가지고있씁니다!! 마침내 인터넷을 항해할 준비가 끝났습니다. 하드웨어 계층은 패킷들을 전화선(phone line)으로 보낼 수 있도록 알파벳 텍스트를 전기 신호로 변환합니다.
6. 당신의 ISP의 반대쪽 끝은 인터넷에 직접 연결되어 있습니다. ISP의 __라우터(router)__ 는 패킷에 적혀있는 목적지를 확인한 뒤 어디로 보낼지 결정합니다. 종종 패킷의 다음 목적지는 또다른 라우터 일 때도 있습니다.
7. 드디어!! 패킷들이 5.6.7.8 컴퓨터에 도착했습니다. 도착한 패킷들은 다시 TCP/IP 프로토콜 스택을 아래에서 위로 통과합니다.
8. 패킷들이 스택을 통과함에 따라, 패킷을 보낸 컴퓨터 스택을 통과하면서 추가되었던 정보들 (IP 주소, 포트번호..) 들이 해당 스택 계층에서 제거됩니다.
9. 마침내 패킷들이 스택의 꼭대기에 다다르면 패킷들은 원래 형태로 합쳐집니다. __안녕!__